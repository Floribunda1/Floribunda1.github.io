---
title: 瀑布流卡片实现
---

最近，公司有一个需求要做瀑布流式卡片，因此在这里简单记录一下自己的思路

其实对于布局来说，最需要关注的就是以下问题

1. 当往仪表盘添加卡片时，卡片应该放在哪里？
2. 当拖动仪表盘的卡片到特定位置时，卡片的位置会怎么变化？
3. 当卡片 resize 以后，该怎么排列？

我觉得要先明确需求：是不是要所有东西都算法搞定？

<font color='tomato'>肯定不行，一定要留人可以调整的余地</font>

所以我觉得正确的解法应该是这样：

人可以调整，然后人调整的位置就直接记下来（但是两栏的和六栏的不兼容怎么办？）

#### 现在想到的几个问题

1. 人工干预了卡片的位置以后数据结构该怎么表示？

2. 移动端（两栏布局）和桌面端（六栏布局）的绝对位置该怎么兼容？

感觉还是要用绝对位置做布局，要不然我感觉做不下去

因为如果不记录绝对位置的话，相当于用户只能调整卡片顺序，无法调整卡片的位置

那要这么说的话感觉这次对于服务端来说更新不会太大（可能对于前端来说改动也不会太大）

假如按照现有的来

```typescript
interface CardPosition {
  x: number;
  y: number;
  size: string;
  // w: number;
  // h: number;
}
```

<font color='teal'>可以开放一键整理功能(笑</font>

不能逃避问题，不能想着依赖他们，唯一的依据只有道理，所以不要想那么多，做自己觉得最正确的事情，而不是等别人的答案

如果 resize 以后 x,y 是否要同步发生变化？

是否要见缝插针排？我自己要考虑到所有情况（要去调研竞品）

整理一下仪表盘的可能排列的边界情况

1. 最右侧的卡片 resize 以后把其他卡片挤走了

我刚刚突然想到

我想列举这些边界情况其实是想做归类整理，试图发现其中的规律

但是这些边界情况可能是无穷无尽的，我很难穷举用户到底想做什么

不管最后是什么方式，都是在算法抉择过程中的某一种策略，我可能影响了某一个原因的权重就会改变最后排列的走向

但是如果我采用从上往下的策略，我又会觉得无从入手，所以正确的做法到底是什么？

先想想自己想达到什么目的？

贪心算法，寻找最优解的过程

<font color='tomato'>寻找最优解的策略：寻找 y 最小，并能容得下该卡片位置的地方</font>

在 resize 或者 drag 改变位置以后，后面所有的卡片进行重排列

在添加卡片时，将卡片放到最后，并能容得下该卡片位置的地方

所以有卡片顺序这一概念吗？

如果卡片有 `group` 这一概念（即用户有意的使用排列的方式将卡片进行分组），那么该不该去破坏用户的组？

所以是不是有可能会有多个卡片拖拽的功能？但是好像解决不了卡片分组的问题（或者说这个需求本身就可能是一个伪需求）

如果不想破坏原来的组，想一想使用场景

一个人小心翼翼的将某一卡片放置在一个空位，防止其他的卡片被挤走

或者还有一个办法，那就是影响有限，如果真的要折行，不去影响后面的行，只去影响当前行的排列，然后将后面的行整体往下挪（但是我觉得不太理想）

不想那么多，最合理的方案就是使用 <font color='teal'>贪心算法</font> 寻求局部最优解！
