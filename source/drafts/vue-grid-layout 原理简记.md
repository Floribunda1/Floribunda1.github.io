---
title: vue-grid-layout 原理简记
---

这里简单记录一下 `grid-layout` 的原理

先想想怎么探究

### 给一组数据，是怎么排序的？

layout:

```
validateLayout(this.layout) 如果 prop 有问题就直接抛出错误
// 如果是 compact 模式，就执行 compact

onWindowResize -> 初始化
initResponsiveFeatures -> 清除所有的响应式 layouts ?

compactLayout -> 压缩一下布局

```



我发现从 0 开始一点点看初始化流程实在是太费劲了，于是想看看 drag 的时候是怎么处理的



drag 的时候有一个 placeholder 占位，每次在拖动的时候都会重新计算位置

拖动元素时，会根据鼠标位置以及拖拽的信息计算出来它将移动到哪里，然后用占位的 item 代替正在拖拽的 item 整体重新进行排序



拖动的时候，当前的元素记录 `dragging` position



每次在拖动的时候

`GridItem` 负责计算新的落点位置

`GridLayout` 负责重排所有的元素



`GridItem` 根据当前位置计算出来在 `grid` 中的位置，然后 `GridLayout` 负责清洗不正确的数据（比如说有 static 的数据，或者什么的，重新计算一个）



`GridLayout` 处理步骤





真他娘的怪，它怎么知道移动到 1,5 了？我一直没找到修改 layout 的地方



我发现 thoughtspot 的想法和我一模一样，每次移动以后都重新排列后面卡片的顺序

但是这就导致了一个问题，人家的 x,y,w,h 压根就没有用，唯一能用的就是 `order`

还不是用贪心算法做的，剩下的用的是动态规划，将卡片添加到合适的位置



感觉需要两者做一个结合，或者说允许做调整算法（这里的核心机制我自己要控制一下）

最后确定方案，不用`x`,`y` 这种绝对定位做，唯一能控制位置的只有顺序和尺寸，然后顺序的编排采用两种算法：贪心和动态规划





我感觉我要崩溃了，我到现在还没摸清楚这个布局到底怎么计算出来落点的位置的

传入 `moveElement` 里面的是 draggingElement 的x和y

我猜可能是根据这个 x，y 然后计算碰撞的图形



感觉要将这里换成顺序调换应该就可以了，但是我感觉好他娘的紧张，可能要搞不完了



救命啊啊啊啊啊，我怎么知道用户要拽到哪里去？或者说落点到底怎么确定啊



感觉还是 typora 给人的感觉最舒服。。



应该问题是我跟卡片碰撞时并不知道往前还是往后插？